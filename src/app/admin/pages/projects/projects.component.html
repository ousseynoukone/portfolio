
<div class="container-fluid bg-primary-color mt-3">
  <div class="row">
    <div *ngIf="isDataComing" class="col-md-12 text-center mt-5">
      <div class="spinner-grow text-danger" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <div class="container mb-4">
      <div class="d-flex gap-2 flex-wrap">
        <button class="btn btn-lg shadow-sm" (click)="addNewProject()" style="background: #990012; border-color: #990012; color: white;">
          <i class="fas fa-plus me-2"></i>Add New Project
        </button>

        <button type="button" (click)="navigateToOrderProject()" class="btn btn-outline-dark btn-lg shadow-sm">
          <i class="fas fa-sort me-2"></i>Order Projects
        </button>
      </div>
    </div>

<!-- Enhanced Projects Table -->
<div *ngIf="!isDataComing" class="projects-container">
  <div class="container-fluid">
    <!-- Table Header with Stats -->
    <div class="table-header mb-4">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h4 class="mb-0">
            <i class="fas fa-project-diagram me-2"></i>Projects Management
          </h4>
        </div>
        <div class="col-md-6 text-end">
          <div class="stats-badge">
            <span class="badge bg-primary fs-6">
              <i class="fas fa-database me-1"></i>
              {{ fireBaseStorage.totalOfItems }} total â€¢ {{ this.fireBaseStorage.limit }} displayed
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Table -->
    <div class="table-responsive">
      <table id="example" class="table table-hover table-striped projects-table">
        <thead class="table-dark">
          <tr>
            <th>
              <i class="fas fa-tag me-1"></i>Title
            </th>
            <th>
              <i class="fas fa-align-left me-1"></i>Description
            </th>
            <th>
              <i class="fas fa-layer-group me-1"></i>Type
            </th>
            <th>
              <i class="fas fa-eye me-1"></i>Status
            </th>
            <th class="text-center">
              <i class="fas fa-cogs me-1"></i>Actions
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let project of projects" class="project-row">
            <!-- Title Column -->
            <td>
              <div class="project-title-cell">
                <h6 class="mb-0 fw-bold">{{ project.title }}</h6>
                <small class="text-muted d-md-none">{{ project.type | uppercase }}</small>
              </div>
            </td>

            <!-- Description Column -->
            <td>
              <div class="project-description-cell">
                <p class="project-description">{{ truncateText(project.minDescription) }}</p>
              </div>
            </td>

            <!-- Type Column -->
            <td>
              <span class="project-type-badge" [ngClass]="getProjectTypeClass(project.type)">
                <i [class]="getProjectTypeIcon(project.type)" class="me-1"></i>
                {{ getProjectTypeLabel(project.type) }}
              </span>
            </td>

            <!-- Status Column -->
            <td>
              <span class="visibility-status" [class.visible]="project.isVisible" [class.hidden]="!project.isVisible">
                <i class="fas" [class.fa-eye]="project.isVisible" [class.fa-eye-slash]="!project.isVisible"></i>
                {{ project.isVisible ? 'Visible' : 'Hidden' }}
              </span>
            </td>

            <!-- Actions Column -->
            <td class="text-center">
              <div class="btn-group" role="group">
                <button class="btn btn-outline-primary btn-sm" 
                        (click)="switchToEditMode(project)"
                        title="Edit Project">
                  <i class="fas fa-edit"></i>
                  <span class="d-none d-lg-inline ms-1">Edit</span>
                </button>
                <button class="btn btn-outline-danger btn-sm" 
                        (click)="deleteproject(project)"
                        title="Delete Project">
                  <i class="fas fa-trash"></i>
                  <span class="d-none d-lg-inline ms-1">Delete</span>
                </button>
                <button class="btn btn-outline-warning btn-sm" 
                        (click)="updateProjectVisibility(project)"
                        [disabled]="isChangingVisibility"
                        title="Toggle Visibility">
                  <span *ngIf="isChangingVisibility" class="spinner-border spinner-border-sm me-1" role="status"></span>
                  <i *ngIf="!isChangingVisibility" class="fas" [class.fa-eye]="!project.isVisible" [class.fa-eye-slash]="project.isVisible"></i>
                  <span *ngIf="!isChangingVisibility" class="d-none d-lg-inline ms-1">{{ project.isVisible ? 'Hide' : 'Show' }}</span>
                </button>
                <button type="button" 
                        (click)="gotoProjectOrderingPage(project)" 
                        class="btn btn-outline-dark btn-sm"
                        title="Manage Images">
                  <i class="fas fa-images"></i>
                  <span class="d-none d-lg-inline ms-1">Images</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-container mt-4">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="pagination-info">
            <span class="text-muted">
              Showing {{ projects.length }} of {{ fireBaseStorage.totalOfItems }} projects
            </span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="pagination-controls d-flex justify-content-end gap-2">
            <button class="btn btn-outline-primary" 
                    [disabled]="fireBaseStorage.weAreOnTheFirstElement" 
                    (click)="getPrevious()">
              <i class="fas fa-chevron-left me-1"></i>Previous
            </button>
            <button class="btn btn-outline-primary" 
                    [disabled]="fireBaseStorage.weAreOntLastElement" 
                    (click)="getNext()">
              Next<i class="fas fa-chevron-right ms-1"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  

</div>


</div>





<!-- Enhanced Modal Client -->
<div class="modal fade" id="formModalProject" tabindex="-1" role="dialog" aria-labelledby="formModalProjectLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content modern-modal">
      <div class="modal-header bg-gradient-primary text-white">
        <div class="modal-title d-flex align-items-center">
          <i class="fas fa-project-diagram me-2"></i>
          <span *ngIf="this.editMode">Update Project</span>
          <span *ngIf="!this.editMode">Add New Project</span>
        </div>
        <button type="button" class="btn-close btn-close-white" (click)="close()" *ngIf="!isLoading" data-bs-dismiss="modal" aria-label="Close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body modern-body">
        <div class="row">
          <div class="col-12" [class.col-md-6]="this.editMode">
            <div class="form-container">
              <form [formGroup]="projectForm" (ngSubmit)="onSubmit()" class="modern-form" id="projectForm">
          
          
              <div class="form-group modern-field">
                <label for="libelle" class="modern-label">
                  <i class="fas fa-tag me-2"></i>Project Title
                </label>
                <input type="text" maxlength="40" id="libelle" class="form-control modern-input" formControlName="title" required placeholder="Enter project title">
                <div class="char-counter">{{projectForm.get('title')?.value?.length || 0}}/40</div>
                <div *ngIf="projectForm.get('title')?.errors && projectForm.get('title')?.touched" class="error-messages">
                  <div class="error-message" *ngIf="projectForm.get('title')!.hasError('required')">
                    <i class="fas fa-exclamation-circle me-1"></i>Title is required
                  </div>
                  <div class="error-message" *ngIf="projectForm.get('title')!.hasError('maxlength')">
                    <i class="fas fa-exclamation-circle me-1"></i>Maximum 40 characters allowed
                  </div>
                </div>
              </div>


              <div class="form-group modern-field">
                <label for="type" class="modern-label">
                  <i class="fas fa-layer-group me-2"></i>Project Type
                </label>
                <select formControlName="type" class="form-select modern-select" aria-label="Select project type">
                  <option *ngFor="let option of options" [value]="option.value" [disabled]="option.value === ''" [selected]="option.value === ''">
                    {{ option.label }}
                  </option>
                </select>
                <div *ngIf="projectForm.get('type')?.errors && projectForm.get('type')?.touched" class="error-messages">
                  <div class="error-message">
                    <i class="fas fa-exclamation-circle me-1"></i>Please select a project type
                  </div>
                </div>
              </div>

                        
              <div class="form-group modern-field">
                <label for="minDescription" class="modern-label">
                  <i class="fas fa-align-left me-2"></i>Short Description
                </label>
                <textarea id="minDescription" maxlength="50" class="form-control modern-textarea" formControlName="minDescription" required placeholder="Brief description of the project"></textarea>
                <div class="char-counter">{{projectForm.get('minDescription')?.value?.length || 0}}/50</div>
                <div *ngIf="projectForm.get('minDescription')?.errors && projectForm.get('minDescription')?.touched" class="error-messages">
                  <div class="error-message" *ngIf="projectForm.get('minDescription')!.hasError('required')">
                    <i class="fas fa-exclamation-circle me-1"></i>Short description is required
                  </div>
                  <div class="error-message" *ngIf="projectForm.get('minDescription')!.hasError('maxlength')">
                    <i class="fas fa-exclamation-circle me-1"></i>Maximum 50 characters allowed
                  </div>
                </div>
              </div>



              <div class="form-group modern-field">
                <label for="fullDescription" class="modern-label">
                  <i class="fas fa-file-alt me-2"></i>Full Description
                </label>
                <textarea id="fullDescription" maxlength="500" class="form-control modern-textarea large" formControlName="fullDescription" required placeholder="Detailed description of the project"></textarea>
                <div class="char-counter">{{projectForm.get('fullDescription')?.value?.length || 0}}/500</div>
                <div *ngIf="projectForm.get('fullDescription')?.errors && projectForm.get('fullDescription')?.touched" class="error-messages">
                  <div class="error-message" *ngIf="projectForm.get('fullDescription')!.hasError('required')">
                    <i class="fas fa-exclamation-circle me-1"></i>Full description is required
                  </div>
                  <div class="error-message" *ngIf="projectForm.get('fullDescription')!.hasError('maxlength')">
                    <i class="fas fa-exclamation-circle me-1"></i>Maximum 500 characters allowed
                  </div>
                </div>
              </div>



              <div class="form-group ">
                <label for="usedTools">Usez Tools : (Please separed it with coma " , ")</label>
                <textarea type="text" id="usedTools" placeholder="Please separed it with coma " maxlength="100" class="form-control" formControlName="usedTools" required> </textarea>
          
                <div *ngIf="projectForm.get('usedTools')?.errors && projectForm.get('usedTools')?.touched">
                  <p class="badge bg-danger mt-1" *ngIf="projectForm.get('usedTools')!.hasError('required')">Used Tools is required.</p>
                  <p class="badge bg-danger mt-1" *ngIf="projectForm.get('usedTools')!.hasError('maxlength')">100 char max.</p>
                  <p class="badge bg-danger mt-1" *ngIf="projectForm.get('usedTools')!.hasError('pattern')">Format non respectÃ©.</p>
                    
                </div>
              </div>


              <div class="form-group ">
                <label for="usefullLinks">Usefull Links : (Please separed it with coma " , ")</label>
                <textarea type="text" id="usefullLinks" maxlength="200" class="form-control" formControlName="usefullLinks" required> </textarea>
          
                <div *ngIf="projectForm.get('usefullLinks')?.errors && projectForm.get('usefullLinks')?.touched">
                  <p class="badge bg-danger mt-1" *ngIf="projectForm.get('usefullLinks')!.hasError('required')">Usefull Links is required.</p>
                    <p class="badge bg-danger mt-1" *ngIf="projectForm.get('usefullLinks')!.hasError('maxlength')">200 char max.</p>
                    <p class="badge bg-danger mt-1" *ngIf="projectForm.get('usefullLinks')!.hasError('pattern')">Format non respectÃ©.</p>

                    
                </div>
              </div>

      <div *ngIf="!editMode" >
              <div class="form-group ">
                      <label for="imgsFile">ScreenShots :</label>
                      <input type="file" #imageInput id="imgsFile" class="form-control" multiple='multiple'  formControlName="imgsFile"    accept="image/*" (change)="onImageChange($event,editMode,false)">
                      <div *ngIf="projectForm.get('imgsFile')?.errors && projectForm.get('imgsFile')?.touched">
                          <p class="badge bg-danger mt-1" *ngIf="projectForm.get('imgsFile')!.hasError('required')" >  Img File  is required.
                        </p>
                      </div>
          
                      <div *ngIf="(isLoading && !editMode) || (editMode && this.fireBaseStorage.isUpdatingimg)">
                        <p class="badge bg-success mt-1" >     {{fireBaseStorage.percentageImg}}%
                      </p>
                    </div>
              </div>





              <div class="form-group ">
                <label for="imageProfileInput">Profile picture :</label>
                <input type="file" #imageProfileInput id="imageProfileInput" class="form-control" multiple='multiple'  formControlName="imageProfileInput"    accept="image/*" (change)="onImageProfileChange($event)">
                <div *ngIf="projectForm.get('imageProfileInput')?.errors && projectForm.get('imageProfileInput')?.touched">
                    <p class="badge bg-danger mt-1" *ngIf="projectForm.get('imageProfileInput')!.hasError('required')" >  Img File  is required.
                  </p>
                </div>
    
                <div *ngIf="(isLoading && !editMode) ">
                  <p class="badge bg-success mt-1" >     {{this.fireBaseStorage.ppPercentage}}%
                </p>
              </div>
            </div>


              <div class="form-group ">
                <label for="videoFile">Video :</label>
                <input type="file" #videoInput id="videoFile" class="form-control" formControlName="videoFile"       accept=".mp4" (change)="onVideoChange($event,editMode)">
                <div *ngIf="projectForm.get('videoFile')?.errors && projectForm.get('videoFile')?.touched" >
                    <p class="badge bg-danger mt-1" *ngIf="projectForm.get('videoFile')!.hasError('required')"> Video File  is required.
                  </p>
                </div>
    
                <div *ngIf="(isLoading && !editMode) || (editMode && this.fireBaseStorage.isUpdatingVideo)">
                  <p class="badge bg-success mt-1" >     {{fireBaseStorage.percentageVideo}}%
                </p>
              </div>
        </div>
  </div>







    
 
          <div class="d-flex justify-content-center">
            <hr *ngIf="this.editMode">  
            <button type="submit" [disabled]="isLoading" class="btn btn-lg mt-3" style="background: #990012; border-color: #990012; color: white;">
              <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              <i *ngIf="!isLoading" class="fas fa-save me-1"></i>
              <span *ngIf="!isLoading && !this.editMode">Add Project</span>
              <span *ngIf="!isLoading && this.editMode">Update Project</span>
            </button>
 


          <button type="button" (click)="close()" data-bs-dismiss="modal"  *ngIf="!this.editMode && !isLoading" class="btn bg-secondary-color p-2 mt-3  text-white mx-1" >
            Close
          </button> 





          
          </div>

          
          
            </form>


            <hr *ngIf="this.editMode">  
            <!-- For adding new image to an project -->

            <div>
            <div *ngIf="editMode" class="text-white bg-accent-color p-2 rounded text-center fs-6 text">Add new Image</div>

            <div  *ngIf="editMode" class="m-1">
              <label for="imgsFile">Image :</label>
              <input type="file" #imageAddInput id="imgsFile" class="form-control" accept="image/*" (change)="onImageChange($event,editMode,true)">
    
              <button type="button" (click)="addNewImageToProject()" [disabled]="isAddinggNewImage" class="btn bg-secondary-color p-2 mt-3  text-white mx-1" > 

                <span *ngIf="isAddinggNewImage" class="spinner-border spinner-border-sm p-3" role="status" aria-hidden="true"></span>
                <span *ngIf="!isAddinggNewImage" role="status" aria-hidden="true">Add image</span>
              </button>
    
              <div *ngIf="this.isAddinggNewImage ">
                <p class="badge bg-success mt-1" >     {{fireBaseStorage.percentageImg}}%
              </p>
            </div>
           </div>
          </div>
          <!-- END  -->
          <hr>  


            <!-- For updating profile image of an  project -->

          <div  *ngIf="editMode">
            <div class="text-white bg-accent-color p-2 rounded text-center fs-6 text">Update profile picture</div>
            <div class="d-flex justify-content-center align-items-center ">
              <img [src]="projectPPlink" (load)="onImageLoad(0,true)" class="img-fluid p-1 m-2  " [class.highlight]="ppIsLoaded" style="max-height: 400px;">
              
              <div *ngIf="!ppIsLoaded" class="d-flex align-items-center justify-content-center m-4">
                <div class="spinner-grow" style="width: 3rem; height: 3rem;" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
            </div>

            <div  class="m-1">
              <label for="imgsFile">Image :</label>
              <input type="file" #imageProfileInput id="imgsFile" class="form-control" accept="image/*" (change)="onImageProfileChange($event)">
    
              <button type="button" (click)="updatePP()" [disabled]="this.fireBaseStorage.isUpdatingPP" class="btn bg-secondary-color p-2 mt-3  text-white mx-1" > 

                <span *ngIf="this.fireBaseStorage.isUpdatingPP" class="spinner-border spinner-border-sm p-3" role="status" aria-hidden="true"></span>
                <span *ngIf="!this.fireBaseStorage.isUpdatingPP" role="status" aria-hidden="true">Update the image</span>
              </button>
    
              <div *ngIf="this.fireBaseStorage.isUpdatingPP ">
                <p class="badge bg-success mt-1" >{{this.fireBaseStorage.ppPercentage}}%</p>
            </div>
           </div>
          </div>
          <!-- END  -->
          </div>
        </div>
















<!-- For updating an image  or Oder image-->
          
        <div *ngIf="this.editMode" class="col-12 col-md-6 mt-3 card">
          <div class="badge bg-secondary-color m-2 text-white ">Choose an image to update/delete</div>

                  <div class="scrollable ">
 
                    <div *ngFor="let image of toUpdateImageUrls; let i = index;">
                      <div class="card-body d-flex justify-content-center align-items-center">
                        <div class="row">
                          <div class="image-update-container">
                            <img [src]="image" class="img-fluid img-default p-1" (load)="onImageLoad(i,false)"  [class.highlight]="i === selectedImageIndex" (click)="OnImageClicked(image,i)" >
                            <div *ngIf="!imagesLoaded[i]" class="spinner-overlay">
                              <div class="spinner-grow" style="width: 3rem; height: 3rem;" role="status">
                                <span class="visually-hidden">Loading...</span>
                              </div>
                            </div>
                          </div>
                          <button *ngIf="i === selectedImageIndex" (click)="deleteOnImage(image)" class="btn btn-sm bg-accent-color mt-1 text-white" > 
                            <span *ngIf="isDeletingOneImage" class="spinner-border spinner-border-sm p-3" role="status" aria-hidden="true"></span>
                            <span *ngIf="!isDeletingOneImage" role="status" aria-hidden="true">Delete</span>
                            
                          </button>

                        </div>

                      </div>
                    </div>
                  </div>

                  <!-- <div class="bg-accent-color p-2 rounded mt-3 mb-1 d-flex justify-content-center align-items-center"> -->
                    <video [src]="toUpdateVideoUrl"  class="embed-responsive embed-responsive-4by3 mt-3" height="400vh" controls muted ></video>
                  <!-- </div> -->


                  <div *ngIf="editMode" >
                    <div class="form-group ">
                            <label for="imgsFile">Image :</label>
                            <input type="file" #imageInput id="imgsFile" class="form-control"  accept="image/*" (change)="onImageChange($event,editMode,false)">
                            <div *ngIf="(isLoading && !editMode) || (editMode && this.fireBaseStorage.isUpdatingimg)">
                              <p class="badge bg-success mt-1" >     {{fireBaseStorage.percentageImg}}%
                            </p>
                          </div>
                    </div>
      
      
                    <div class="form-group ">
                      <label for="videoFile">Video :</label>
                      <input type="file" #videoInput id="videoFile" class="form-control"        accept=".mp4" (change)="onVideoChange($event,editMode)">       
                      <div *ngIf="(isLoading && !editMode) || (editMode && this.fireBaseStorage.isUpdatingVideo)">
                        <p class="badge bg-success mt-1" >     {{fireBaseStorage.percentageVideo}}%
                      </p>
                    </div>
                    </div>
                  </div>

                  <button type="button" (click)="updateVideoImage()" [disabled]="isUpdatingMultimedia" class="btn bg-accent-color p-2 m-3 text-white" >
          
                    <span *ngIf="isUpdatingMultimedia" class="spinner-border spinner-border-sm p-3" role="status" aria-hidden="true"></span>
                    <span *ngIf="!isUpdatingMultimedia && this.editMode" >Update multimedia</span>
                  
                  </button>



                </div>
 
<!-- For updating an image  or Oder image-->


        


           
          </div>        
      </div>
      <button type="button" (click)="saveChange()" *ngIf="this.editMode && !isUpdatingMultimedia" class="btn bg-secondary-color p-2 m-3  text-white mx-1" >
        Done and Save Change
      </button>
      
    </div>
  </div>
</div>



